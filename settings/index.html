<!doctype html>
<html>
  <head>
    <!-- The '/homey.js' script must be included in your settings view to work -->
    <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
    <script type="text/javascript" src="/manager/webserver/assets/js/jquery.js"></script>
  </head>
    <body>
        <h1 data-i18n="Send SMS settings page"> </h1>
        <div id="panel-buttons">
          <button id="panel-button-1" class="button panel-button" onclick="showPanel(1)" data-i18n="settingsTitle">Settings</button>&nbsp;
          <button id="panel-button-2" class="button panel-button" onclick="showPanel(2)" data-i18n="loggingTitle">Logging</button>&nbsp;
          <br><br>
        </div>
        <!-- Settings panel -->
        <div id="panel-1" class="panel">
        <fieldset>
            <legend data-i18n="provider and login information"> </legend>
            <div class="field row">
              <label for="provider" data-i18n="Provider"> </label>
              <select id="provider" onchange="providerSelected()" >
								<option value="https://46elks.com">46Elks</option>
                <option value="https://json.aspsms.com">aspSMS</option>
								<option value="https://www.bulksms.com">bulkSMS</option>
                <option value="https://api.clickatell.com">Clickatell</option>
                <option value="https://sgw01.cm.nl">CM Direct</option>
                <option value="https://smsgateway.me">smsGateway</option>
                <option value="https://api.spryngsms.com">SpryngSMS</option>
                <option value="http://www.targetsms.nl">TargetSMS</option>
                <option value="http://textbelt.com/">Textbelt</option>
                <option value="https://api.twilio.com">Twilio</option>
                <option value="https://www.12VoIP.com">==== DellMont Providers ====</option>
                <option value="https://www.12VoIP.com">12VoIP</option>
                <option value="https://www.Actionvoip.com">Actionvoip</option>
                <option value="https://www.BrowserCalls.com">BrowserCalls</option>
                <option value="https://www.BudgetVoip.com">BudgetVoip</option>
                <option value="https://www.BudgetVoipCall.com">BudgetVoipCall</option>
                <option value="https://www.Call2India.com">Call2India</option>
                <option value="https://www.CallEasy.com">CallEasy</option>
                <option value="https://www.CallingCardBuster.com">CallingCardBuster</option>
                <option value="https://www.CallingCredit.com">CallingCredit</option>
                <option value="https://www.CallPirates.com">CallPirates</option>
                <option value="https://www.CheapBuzzer.com">CheapBuzzer</option>
                <option value="https://www.CheapVoip.com">CheapVoip</option>
                <option value="https://www.CheapVoipCall.com">CheapVoipCall</option>
                <option value="https://www.CosmoVoip.com">CosmoVoip</option>
                <option value="https://www.DialCheap.com">DialCheap</option>
                <option value="https://www.DialNow.com">DialNow</option>
                <option value="https://www.DiscountCalling.com">DiscountCalling</option>
                <option value="https://www.DiscountVoip.com">DiscountVoip</option>
                <option value="https://www.EasyVoip.com">EasyVoip</option>
                <option value="https://www.FreeCall.com">FreeCall</option>
                <option value="https://www.FreeVoipDeal.com">FreeVoipDeal</option>
                <option value="https://www.Frynga.com">Frynga</option>
                <option value="https://www.GlobalFreecall.com">GlobalFreecall</option>
                <option value="https://www.HotVoip.com">HotVoip</option>
                <option value="https://www.Internetcalls.com">Internetcalls</option>
                <option value="https://www.InterVoip.com">InterVoip</option>
                <option value="https://www.Jumblo.com">Jumblo</option>
                <option value="https://www.JustVoip.com">JustVoip</option>
                <option value="https://www.LowRateVoip.com">Low-Rate Voip</option>
                <option value="https://www.MegaVoip.com">MegaVoip</option>
                <option value="https://www.MexicoBarato.com">MexicoBarato</option>
                <option value="https://www.NairaCalls.com">NairaCalls</option>
                <option value="https://www.Netappel.com">Netappel</option>
                <option value="https://www.Nonoh.com">Nonoh</option>
                <option value="https://www.PanggilanMalaysia.com">PanggilanMalaysia</option>
                <option value="https://www.PennyConnect.com">PennyConnect</option>
                <option value="https://www.PinoyDialer.com">PinoyDialer</option>
                <option value="https://www.PoivY.com">PoivY</option>
                <option value="https://www.PowerVoip.com">PowerVoip</option>
                <option value="https://www.RebVoice.com">RebVoice</option>
                <option value="https://www.Rynga.com">Rynga</option>
                <option value="https://www.SIPDiscount.com">SIPDiscount</option>
                <option value="https://www.SmartVoip.com">SmartVoip</option>
                <option value="https://www.SMSDiscount.com">SMS Discount</option>
                <option value="https://www.SMSLISTO.com">SMSLISTO</option>
                <option value="https://www.StuntCalls.com">StuntCalls</option>
                <option value="https://www.SuperVoip.com">SuperVoip</option>
                <option value="https://www.Telbo.com">Telbo</option>
                <option value="https://www.VoiceTrading.com">VoiceTrading</option>
                <option value="https://www.VoipaLot.com">VoipaLot</option>
                <option value="https://www.Voipblast.com">Voipblast</option>
                <option value="https://www.VoipBlazer.com">VoipBlazer</option>
                <option value="https://www.VoipBuster.com">VoipBuster</option>
                <option value="https://www.VoipbusterPro.com">VoipbusterPro</option>
                <option value="https://www.VoipCaptain.com">VoipCaptain</option>
                <option value="https://www.VoIPCheap.com">VoIPCheap</option>
                <option value="https://www.VoipCheap.com">VoipCheap</option>
                <option value="https://www.VoipChief.com">VoipChief</option>
                <option value="https://www.VoipDiscount.com">VoipDiscount</option>
                <option value="https://www.VoipGain.com">VoipGain</option>
                <option value="https://www.VoipJumper.com">VoipJumper</option>
                <option value="https://www.VoipMove.com">VoipMove</option>
                <option value="https://www.VoipR.com">VoipR</option>
                <option value="https://www.VoipRaider.com">VoipRaider</option>
                <option value="https://www.VoipSmash.com">VoipSmash</option>
                <option value="https://www.VoipStunt.com">VoipStunt</option>
                <option value="https://www.VoipWise.com">VoipWise</option>
                <option value="https://www.VoipYo.com">VoipYo</option>
                <option value="https://www.VoipZoom.com">VoipZoom</option>
                <option value="https://www.WebCallDirect.com">WebCallDirect</option>
              </select>
              <a id="provider_url" target="_blank">
                <i class="fa fa-external-link" aria-hidden="true"></i>
              </a>
            </div>
            <div class="field row">
                <label for="api_id" data-i18n="Api ID"> </label>
                <input id="api_id" type="text" value="" />
            </div>
            <div class="field row">
                <label for="username" data-i18n="Username"> </label>
                <input id="username" type="text" value="" />
            </div>
            <div class="field row">
                <label for="password" data-i18n="Password"> </label>
                <input id="password" type="password" value="" />
            </div>
            <div class="field row">
                <label for="from" data-i18n="From number"> </label>
                <input id="from" type="text" placeholder="" value="" />
            </div>
            <div class="field row">
                <label for="toTest" data-i18n="Test number"> </label>
                <input id="toTest" type="text" value="" />
            </div>
            <div class="field row">
                <label for="testMessage" data-i18n="Test message"> </label>
                <textarea id="testMessage"></textarea>
            </div>
            <div id="testresult"></div>
        </fieldset>
        <button class="left" id="button_test" onclick="test()" data-i18n="Test"> </button>
        <button class="right" id="button_restore" onclick="reload()" data-i18n="Reset"> </button>
        <button class="right" id="button_save" onclick="save()" data-i18n="Save"> </button>
        </div>

        <!-- Debug logs panel -->
        <div id="panel-2" class="panel">
          <button type="button" class="right" id="button_deletelog" onclick="deleteLogs()" data-i18n="deletelogs">Delete Logs</button>
          <button type="button" class="right" id="button_getlog" onclick="showLogs()" data-i18n="getlogs">Get Logs</button>
          <div id="loglines"></div>
        </div>

        <script type="text/javascript">

        function showPanel(panel) {
          $('.panel').hide()
          $('.panel-button').removeClass('panel-button-active').addClass('panel-button-inactive')
          $('#panel-button-' + panel).removeClass('panel-button-inactive').addClass('panel-button-active')
          $('#panel-' + panel).show()
          if (panel === 2) {
            showLogs();
          }
        }

        var saveData;
        var HomeyAPI = null;

        // triggered when user opens settings page
        function onHomeyReady(Homey){
    			HomeyAPI = Homey;
					var providerUrlElement = document.getElementById('provider_url');
          providerUrlElement.addEventListener('click', function(e) {
            Homey.openURL(providerUrlElement.href);
          });
          document.getElementById('testresult').innerHTML = " ";
          button_save.disabled = true; // Disable save button until settings have been saved
          // document.getElementById("provider_url").setAttribute("href", "http://textbelt.com");
          document.getElementById('api_id').disabled=true;
          document.getElementById('username').disabled=true;
          document.getElementById('password').disabled=true;
          document.getElementById('from').disabled=true;
          Homey.get('settings', function(err, storedData) {
            if (err) {
              return Homey.alert( err );
            } else {
              //console.log('got data: ', storedData);
              if ((storedData != null) && (storedData != undefined)) {
                document.getElementById('provider').value = storedData.provider;
                document.getElementById("provider_url").setAttribute("href", storedData.provider);
                document.getElementById('api_id').value = storedData.api_id;
                document.getElementById('username').value = storedData.username;
                document.getElementById('password').value = storedData.password;
                document.getElementById('from').value = storedData.from;
                document.getElementById('toTest').value = storedData.toTest;
                document.getElementById('testMessage').value = storedData.testMessage;
              } else {document.getElementById('provider').value = "http://textbelt.com"};
            }
            providerSelected();
            button_save.disabled = false;
            showPanel(1);
            Homey.ready();  //ready to show the settings page
          });
        }

        function reload() {
          location.reload();
        };

        function test() {
          document.getElementById('testresult').innerHTML = " ";
          saveData = {
            provider    : document.getElementById('provider').value,
            username    : document.getElementById('username').value,
            api_id      : document.getElementById('api_id').value,
            password    : document.getElementById('password').value,
            from        : document.getElementById('from').value,
            toTest      : document.getElementById('toTest').value,
            testMessage : document.getElementById('testMessage').value,
            url         : document.getElementById('provider').value
          };
          HomeyAPI.api('POST', '/testSMS', saveData, function(error, result) {
  					if (error) {
  						HomeyAPI.alert(error, 'error');
  					}
  					else {
  						HomeyAPI.alert(result, 'info');
  					}
  				});
        }

        function save() {
          document.getElementById('testresult').innerHTML = " ";
          saveData = {
            provider    : document.getElementById('provider').value,
            username    : document.getElementById('username').value,
            api_id      : document.getElementById('api_id').value,
            password    : document.getElementById('password').value,
            from        : document.getElementById('from').value,
            toTest      : document.getElementById('toTest').value,
            testMessage : document.getElementById('testMessage').value,
            url         : document.getElementById('provider').value
          };
          HomeyAPI.set('settings', saveData, function (error) {
            if (error) {
              HomeyAPI.alert(error, 'error');
            } else {
              HomeyAPI.alert(HomeyAPI.__("settingsSaved"), 'info');
            }
          });
        }

//disable fields that are not relevant for selected provider
        function providerSelected() {
          document.getElementById('testresult').innerHTML = " ";
          document.getElementById("provider_url").setAttribute("href", document.getElementById('provider').value);
          document.getElementById('api_id').disabled=true;
          document.getElementById('username').disabled=false;
          document.getElementById('password').disabled=false;
          document.getElementById('from').disabled=false;
          if (document.getElementById('provider').value.substr(0, 15)=='http://textbelt'){
            document.getElementById("provider_url").setAttribute("href", "http://www.textbelt.com");
            document.getElementById('api_id').disabled=false;
            document.getElementById('username').disabled=true;
            document.getElementById('username').value = "";
            document.getElementById('password').disabled=true;
            document.getElementById('password').value = "";
            document.getElementById('from').disabled=true;
            document.getElementById('from').value = "";
          } else
          if (document.getElementById('provider').value.substr(0, 22)=='https://api.clickatell'){
            document.getElementById("provider_url").setAttribute("href", "https://www.clickatell.com");
            document.getElementById('api_id').disabled=false;
          } else
          if (document.getElementById('provider').value.substr(0, 20)=='http://www.targetsms'){
            document.getElementById("provider_url").setAttribute("href", "http://www.targetsms.nl");
            document.getElementById('api_id').disabled=false;
          } else
          if (document.getElementById('provider').value.substr(0, 20)=='https://smsgateway.m'){
            document.getElementById("provider_url").setAttribute("href", "http://smsgateway.me");
						document.getElementById('api_id').disabled=false;
						document.getElementById('username').disabled=true;
						document.getElementById('username').value = "";
						document.getElementById('password').disabled=true;
						document.getElementById('password').value = "";
          } else
          if (document.getElementById('provider').value.substr(0, 20)=='https://api.spryngsm'){
            document.getElementById("provider_url").setAttribute("href", "http://www.spryng.nl");
          } else
          if (document.getElementById('provider').value.substr(0, 20)=='https://api.twilio.c'){
            document.getElementById("provider_url").setAttribute("href", "https://www.twilio.com");
            document.getElementById('api_id').disabled=false;
            document.getElementById('username').disabled=true;
            document.getElementById('username').value = "";
          }else
          if (document.getElementById('provider').value.substr(0, 19)=='https://sgw01.cm.nl'){
            document.getElementById("provider_url").setAttribute("href", "https://www.cm.nl");
            document.getElementById('api_id').disabled=false;
            document.getElementById('username').disabled=true;
            document.getElementById('username').value = "";
            document.getElementById('password').disabled=true;
            document.getElementById('password').value = "";
          } else
          if (document.getElementById('provider').value.substr(0, 20)=='https://json.aspsms.'){
            document.getElementById("provider_url").setAttribute("href", "https://www.aspsms.com");
            document.getElementById('api_id').disabled=false;
            document.getElementById('username').disabled=true;
          } else
					if (document.getElementById('provider').value.substr(0, 20)=='https://www.bulksms.'){
            document.getElementById('from').disabled=true;
          }

      	}

        function showLogs() {
         HomeyAPI.api('GET', 'getlogs/', function(err, result) {
            if (!err) {
               document.getElementById('loglines').innerHTML = '';
               for (var i=(result.length - 1); i >= 0; i--) {
                  document.getElementById('loglines').innerHTML += result[i];
                  document.getElementById('loglines').innerHTML += "<br />";
               }
            };
         });
        }
        function deleteLogs() {
           HomeyAPI.api('GET', 'deletelogs/', function(err, result) {
             if (err) {
               HomeyAPI.alert( err.message, 'error' ); // [, String icon], Function callback )
             } else { HomeyAPI.alert( 'Logs deleted!', 'info' ); }
           });
        }

        </script>
    </body>
</html>
